import React, { useState, useEffect } from 'react';
import { Button } from 'reactstrap';
import { connect } from 'react-redux';
import './DoctorList.css';

function DoctorList(props) {
  const myDoctors = props.methodics.filter((methodic) => methodic.doctorEmail !== undefined);


  const [photo, setPhoto] = useState(null);
  const [status, setStatus] = useState(false);
  const [doctors, setDoctorData] = useState([]);

  const { doctorEmail } = props.methodics[0];

  const photoFetch = async () => {
    const response = await fetch('http://localhost:5000/personal/data', {
      method: 'POST',
      headers: {
        'Content-type': 'application/json',
      },
      body: JSON.stringify({
        doctorEmail,
      }),
    });
    const result = await response.json();
    setPhoto(result.photo);
  };

  useEffect(
    () => {
      photoFetch();
      myDoctors.forEach((doctor) => {
        const { specialist, doctorName, _id } = doctor;
        // setDoctorData({ specialist, doctorName, _id });
        doctors.push({ specialist, doctorName, _id });
      });
    }, [],
  );

  const deleteHandler = () => {
    setStatus(true);
  };

  const doctorsList = doctors.map((doctor) => {
    <li key={doctor._id}>
      <p>
        {doctor.doctorName}
      </p>
      <img src={photo} alt="doctor's face" />
      <p className="speciality">
        Cпециальность:
        {' '}
        {doctor.specialist}
      </p>
      <p>
        <Button outline color="success">Связаться</Button>
        <Button outline color="danger">Удалить</Button>
      </p>
    </li>
  });


  return (
    <>
    <div>
      <ul>
        {doctorsList}
      </ul>
    </div>
    </>
  );
}

const mapStateToProps = (state) => ({
  methodics: state.getInfo.methodics,
  user: state.logIn.user,
});

export default connect(
  mapStateToProps,
)(DoctorList);
